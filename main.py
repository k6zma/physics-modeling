import streamlit as st
from streamlit_extras.switch_page_button import switch_page
from simulation.trajectory import BodyTrajectory
from simulation.animator import animate_trajectory
from web.interface import render_sidebar, display_information, display_parameters

def main():
    st.set_page_config(page_title="–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ", page_icon="üìò")

    logo_path = "img/logo.png"
    st.sidebar.image(logo_path)

    page = st.sidebar.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É:", ["–¢–µ–æ—Ä–∏—è", "–°–∏–º—É–ª—è—Ü–∏—è"])

    if page == "–¢–µ–æ—Ä–∏—è":
        st.title("–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å –∑–∞–¥–∞—á–∏")

        st.markdown(
            """
            ### –£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏
            –¢–µ–ª–æ –º–∞—Å—Å–æ–π $m$, —Ä–∞–∑–≥–æ–Ω—è–µ—Ç—Å—è –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø–ª–æ—Å–∫–æ—Å—Ç–∏ –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ
            —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–ª—å—Ü–∞ (–¥—É–≥—É) —Ä–∞–¥–∏—É—Å–∞ $R$ –∏ —É–≥–ª–æ–≤—ã–º —Ä–∞–∑–º–µ—Ä–æ–º $a$ ($\\frac{\\pi}{2} \\leq a \\leq \\frac{3\\pi}{2}$).
            –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å —Ç–µ–ª–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ–π –¥–ª–∏–Ω—ã –¥—É–≥–∏. –ò–∑–æ–±—Ä–∞–∑–∏—Ç—å
            —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é —Ç–µ–ª–∞ –ø–æ—Å–ª–µ –æ—Ç—Ä—ã–≤–∞ –æ—Ç –¥—É–≥–∏. –î—É–≥–∞ –∏–º–µ–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç—Ä–µ–Ω–∏—è $\\mu$.
            """
        )

        st.markdown(
            """
		### –ü–æ–¥—Ö–æ–¥ –∫ —Ä–µ—à–µ–Ω–∏—é
		#### 1. –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ $v_0$

		–ù–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å $v_0$ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ –∑–∞–∫–æ–Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏:
		$$
		\\frac{m v_0^2}{2} = E_–ø + W_{\\text{—Ç—Ä}}
		$$

		–†–µ—à–∏–≤ —ç—Ç–æ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ $v_0$ –ø–æ–ª—É—á–∞–µ–º:
		$$
		v_0 = \sqrt{\\frac{2*(E_–ø + W_{\\text{—Ç—Ä}})}{m}}
		$$

		#### 2. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è $E_–ø$

		–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –Ω–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –¥—É–≥–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –≤—ã—Å–æ—Ç–µ $h = 0$ (–Ω–∞—á–∞–ª–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç) –∏ —Ç–µ–ª–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –Ω–∞ –¥—É–≥–µ. 
		–î–ª—è –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –¥—É–≥–∏ –≤—ã—Å–æ—Ç–∞ $h$ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–∞:
		$$
		h = R*(1 - \cos(a))
		$$

		–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è $E_–ø$ –Ω–∞ –≤—ã—Å–æ—Ç–µ $h$ –±—É–¥–µ—Ç:
		$$
		E_–ø = m*g*h = m*g*R*(1 - \cos(a))
		$$

		#### 3. –†–∞–±–æ—Ç–∞ —Å–∏–ª—ã —Ç—Ä–µ–Ω–∏—è $W_{\\text{—Ç—Ä}}$

		–ï—Å–ª–∏ —Å–∏–ª–∞ —Ç—Ä–µ–Ω–∏—è $f = \mu*N$ –ø–æ—Å—Ç–æ—è–Ω–Ω–∞ –Ω–∞ –≤—Å—ë–º –ø—É—Ç–∏, —Ç–æ –µ—ë —Ä–∞–±–æ—Ç–∞ –≤–¥–æ–ª—å –ø—É—Ç–∏ $s$ –ø–æ –¥—É–≥–µ –±—É–¥–µ—Ç:
		$$
		W_{\\text{—Ç—Ä}} = f * s
		$$

		–°–∏–ª–∞ —Ä–µ–∞–∫—Ü–∏—è –æ–ø–æ—Ä—ã $N$ –≤–¥–æ–ª—å –¥—É–≥–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞—Å—Å—ã –∏ —É–≥–ª–∞ $a$:
		$$
		N = m * g * \cos(a)
		$$

		–¢–æ–≥–¥–∞ —Å–∏–ª–∞ —Ç—Ä–µ–Ω–∏—è:
		$$
		f = \mu * m * g * \cos(a)
		$$

		–∏ —Ä–∞–±–æ—Ç–∞ —Å–∏–ª—ã —Ç—Ä–µ–Ω–∏—è –Ω–∞ –≤—Å—ë–º –ø—É—Ç–∏ –ø–æ –¥—É–≥–µ:
		$$
		W_{\\text{—Ç—Ä}} = \int_0^{a} \mu \, m \, g \, \cos(a) \, R \, da
		$$

		#### 4. –ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏

		–¢–µ–ø–µ—Ä—å –ø–æ–¥—Å—Ç–∞–≤–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è $E_–ø$ –∏ $W_{\\text{—Ç—Ä}}$ –≤ —Ñ–æ—Ä–º—É–ª—É –¥–ª—è $v_0$:
		$$
		v_0 = \sqrt{\\frac{2 * (m*g*R*(1 - \cos(a)) + \mu * m * g * \sin(a) * R*a)}{m}}
		$$
    """
        )

    elif page == "–°–∏–º—É–ª—è—Ü–∏—è":
        st.title("–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏—è —Ç–µ–ª–∞ –Ω–∞ –¥—É–≥–µ –∏ –ø–æ—Å–ª–µ –æ—Ç—Ä—ã–≤–∞")

        mass, radius, friction, angle = render_sidebar()

        display_parameters(mass, radius, friction, angle)

        if st.sidebar.button("–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é"):
            trajectory = BodyTrajectory(mass=mass, radius=radius, friction=friction, angle=angle)
            st.write("–ü–æ–∏—Å–∫ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞—á–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏...")
            try:
                trajectory.find_min_initial_velocity()
                display_information(trajectory.v0_min)

                x_full, y_full, x_flight, y_flight, v_final, start_point, end_point = trajectory.calculate_trajectory()
                st.write("–°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏...")
                animate_trajectory(x_full, y_full, x_flight, y_flight, start_point, end_point, trajectory.v0_min)
            except ValueError as e:
                st.error(f"–û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    main()
